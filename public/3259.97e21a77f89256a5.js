"use strict";(self.webpackChunkvex=self.webpackChunkvex||[]).push([[3259],{83259:(Y,f,o)=>{o.r(f),o.d(f,{FacturaVentaModule:()=>$});var _=o(96814),m=o(29522),M=o(33594),O=o(83951),n=o(56223),x=o(65364),C=o(84005),e=o(65879),N=o(69162),y=o(64876),I=o(22939),g=o(19347),b=o(30617),v=o(32296);function q(i,B){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",31),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.Cerrar(!0))}),e._uU(2,"Cancel"),e.qZA(),e.TgZ(3,"button",32),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.Facturar(!0))}),e._uU(4),e.qZA(),e._UZ(5,"button",33),e.BQk()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("disabled",!t.form.valid),e.xp6(1),e.hij(" ",t.Texto,"")}}function U(i,B){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.Cerrar(!0))}),e._uU(2,"Cancel"),e.qZA(),e.TgZ(3,"button",32),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.Facturar(!0))}),e._uU(4),e.qZA(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("disabled",t.form.valid),e.xp6(2),e.Q6J("disabled",t.form.valid),e.xp6(1),e.hij(" ",t.Texto,"")}}const D=[{path:"",component:(()=>{class i{constructor(t,r,a,s,c,l){this.facturaService=t,this.tranferenciaService=r,this.fb=a,this.snackBar=s,this.router=c,this.dialog=l,this.SubTotal="0.00",this.Iva="0.00",this.Total="0.00",this.valido=!1,this.Texto="Facturar",this.ancho="500px",this.largo="500px",this.titulo="Razon de Anulacion",this.razon="",this.verificar=!1,this.IMG_Sucursal="../../../../assets/sucursal.jpg",this.Nombre_Cliente="C/F",this.NIT_Cliente="",this.Direccion_Cliente="",this.Departamento_Cliente="",this.Municipio_Cliente="",this.Telefono_Cliente="",this.form=this.fb.group({Nombre:[""],c_Img_Base:["0"],Id_Empleado:[],c_ID_Rol_Persona:[,n.kI.required],c_Id_Sucursal:[,n.kI.required],c_Id_Genero:[,n.kI.required],c_Tipo_Cuenta:[,n.kI.required],Primer_Nombre:["",n.kI.compose([n.kI.required,n.kI.minLength(1),n.kI.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xfc\xdc\xf1\xd1]*$/)])],Segundo_Nombre:["",n.kI.compose([n.kI.required,n.kI.minLength(1),n.kI.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xfc\xdc\xf1\xd1]*$/)])],Tercer_Nombre:["",n.kI.compose([n.kI.minLength(1),n.kI.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xfc\xdc\xf1\xd1]*$/)])],Primer_Apellido:["",n.kI.compose([n.kI.required,n.kI.minLength(1),n.kI.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xfc\xdc\xf1\xd1]*$/)])],Segundo_Apellido:["",n.kI.compose([n.kI.required,n.kI.minLength(1),n.kI.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xfc\xdc\xf1\xd1]*$/)])],Apellido_Casada:["",n.kI.compose([n.kI.minLength(1),n.kI.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xfc\xdc\xf1\xd1]*$/)])],c_Id_Departamento:[,n.kI.required],c_Id_Municipio:[,n.kI.required],DPI:["",n.kI.compose([n.kI.required,n.kI.minLength(13),n.kI.maxLength(13)])],NIT:["",n.kI.compose([n.kI.minLength(8),n.kI.maxLength(12),n.kI.pattern(/^[\d-]*$/)])],Direccion:["",n.kI.compose([n.kI.required,n.kI.minLength(1),n.kI.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xfc\xdc\xf1\xd1\s\d,.-]*$/)])],Telefono_Principal:["",n.kI.compose([n.kI.required,n.kI.minLength(8),n.kI.maxLength(8),n.kI.pattern(/^[0-9]*$/)])],Telefono_Secundario:["",n.kI.compose([n.kI.minLength(8),n.kI.maxLength(8),n.kI.pattern(/^[0-9]*$/)])],Correo:["",[n.kI.required,n.kI.email]],Fecha_Nacimiento:[""],c_Usuario_CoM:[""],Razon:[""],Id_Cuenta:[""],Empresa:["",n.kI.compose([n.kI.required,n.kI.minLength(1),n.kI.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xfc\xdc\xf1\xd1\s\d,.-]*$/)])]})}ngOnInit(){0==this.tranferenciaService.validarFactura?(this.tranferenciaService.validarFactura=!1,this.router.navigate(["/apps/FacturaVenta/table"])):this.tranferenciaService.validarFactura=!0;const t=new Date,r=t.getFullYear(),a=t.getMonth()+1,s=t.getDate();this.Fecha=`${r}-${a<10?"0":""}${a}-${s<10?"0":""}${s}`,this.Id_Producto=this.tranferenciaService.idProducto,this.NombreProducto=this.tranferenciaService.NombreProducto,this.Cantidad=this.tranferenciaService.Cantidad,this.Precio=this.tranferenciaService.Precio,this.Total=this.formatearPrecio(this.tranferenciaService.Total),this.Iva=this.formatearPrecio(this.tranferenciaService.IVA),this.SubTotal=this.formatearPrecio(this.tranferenciaService.SubTotal);const l=document.getElementById("tabla-body"),p=this.NombreProducto.split(";");for(let u=0;u<p.length;u++){const T=this.Id_Producto.split(";"),J=this.NombreProducto.split(";"),Z=this.Precio.split(";"),S=this.Cantidad.split(";");console.log(T[u]);const d=document.createElement("tr");d.classList.add("text-gray-700");const k=document.createElement("td");k.textContent=T[u];const F=document.createElement("td");F.textContent=J[u];const P=document.createElement("td");P.textContent=parseFloat(Z[u]).toFixed(2);const A=document.createElement("td");A.textContent=S[u];const Q=parseFloat(Z[u])*parseInt(S[u],10),h=document.createElement("td");h.style.textAlign="right",h.classList.add("font-medium"),h.textContent=Q.toFixed(2),d.appendChild(k),d.appendChild(F),d.appendChild(P),d.appendChild(A),d.appendChild(h),l.appendChild(d)}1==this.tranferenciaService.VPersona?this.GenerarFacturaCliente():this.GenerarFacturaCF()}formatearPrecio(t){let r=parseFloat(t);return r=parseFloat(r.toFixed(2)),r.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}GenerarFacturaCliente(){this.facturaService.getFacturaVentaCliente(this.tranferenciaService.idSerie,this.tranferenciaService.idsl,this.tranferenciaService.idPersona).subscribe(t=>{console.log(t),this.Numero_Serie=t.response.c_Numero_Serie,this.Numero_Factura=t.response.c_Numero_Factura,this.Nombre_Sucursal=t.response.c_Nombre_Sucursal,this.Departamento_Sucursal=t.response.c_Departamento_Sucursal,this.Municipio_Sucursal=t.response.c_Municipio_Sucursal,this.Direccion_Sucursal=t.response.c_Direccion_Sucursal,this.Correo_Sucursal=t.response.c_Correo_Sucursal,this.Telefono_Sucursal=t.response.c_Numero_Telefono,this.NIT_Sucursal=t.response.c_NIT_Sucursal,this.IMG_Sucursal=t.response.c_IMG_Sucursal,this.Nombre_Cliente=t.response.c_Nombre_Cliente,this.NIT_Cliente=t.response.c_NIT,this.Direccion_Cliente=t.response.c_Direccion,this.Departamento_Cliente=t.response.c_Departamento,this.Municipio_Cliente=t.response.c_Municipio,this.Telefono_Cliente=t.response.c_Telefono})}GenerarFacturaCF(){this.facturaService.getFacturaVentaCF(this.tranferenciaService.idSerie,this.tranferenciaService.idsl).subscribe(t=>{console.log(t),this.Numero_Serie=t.response.c_Numero_Serie,this.Numero_Factura=t.response.c_Numero_Factura,this.Nombre_Sucursal=t.response.c_Nombre_Sucursal,this.Departamento_Sucursal=t.response.c_Departamento_Sucursal,this.Municipio_Sucursal=t.response.c_Municipio_Sucursal,this.Direccion_Sucursal=t.response.c_Direccion_Sucursal,this.Correo_Sucursal=t.response.c_Correo_Sucursal,this.Telefono_Sucursal=t.response.c_Numero_Telefono,this.NIT_Sucursal=t.response.c_NIT_Sucursal,this.IMG_Sucursal=t.response.c_IMG_Sucursal})}generarPDF(){const t=document.getElementById("pdf-content");x().from(t).set({margin:10,filename:"mi_archivo.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).outputPdf(a=>{a.output("dataurlnewwindow")})}GenerarPDF(){let t=!1;const r=document.getElementById("pdf-content");return new Promise((s,c)=>{const l=new Image;l.src=this.IMG_Sucursal,l.onload=()=>{s(l)},l.onerror=p=>{c(p)}}).then(s=>{t=!0;const c=document.createElement("canvas");c.getContext("2d").drawImage(s,0,0,c.width,c.height),x().set({margin:0,filename:"factura.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"portrait"}}).from(r).save(),URL.revokeObjectURL(s.src)}).catch(s=>{t=!1,console.error("Error al cargar la imagen:",s)}),t}Cerrar(t){this.titulo="\xbfEst\xe1s seguro de que deseas cancelar la factura?",this.razon="Razon por la cual se crea el registro",this.verificar=!1,this.ancho="15rem",this.largo="25rem",this.dialog.open(C.$,{height:this.ancho,width:this.largo,data:{title:this.titulo,razon:this.razon,valido:this.verificar}}).afterClosed().subscribe(a=>{0!=a&&(this.router.navigate(["/apps/FacturaVenta/table"]),this.snackBar.open("Factura Cancelada","Cerrar",{duration:5e3,panelClass:["success-snackbar"]}))})}Facturar(t){this.titulo="\xbfEst\xe1s seguro de que deseas guardar la factura?",this.razon="Razon por la cual se crea el registro",this.verificar=!1,this.ancho="15rem",this.largo="25rem",this.dialog.open(C.$,{height:this.ancho,width:this.largo,data:{title:this.titulo,razon:this.razon,valido:this.verificar}}).afterClosed().subscribe(a=>{0!=a&&(console.log("entro"),this.body=this.tranferenciaService.body,console.log(this.body),this.facturaService.setFactura(this.body).subscribe(c=>{c.ok?(this.valido=!0,this.tranferenciaService.validarFactura=!1,1==this.GenerarPDF()||this.snackBar.open("Error al Generar PDF","Cerrar",{duration:15e3,panelClass:["error-snackbar"]}),this.router.navigate(["/apps/FacturaVenta/table"]),this.snackBar.open(c.transaccion_Mensaje,"Cerrar",{duration:5e3,panelClass:["success-snackbar"]})):(this.valido=!0,this.snackBar.open("Codigo de Error: "+c.transaccion_Estado+" Mensje: "+c.transaccion_Mensaje,"Cerrar",{duration:1e4,panelClass:["red-snackbar"]}))},c=>{this.snackBar.open("Error Inesperado","Cerrar",{duration:15e3,panelClass:["error-snackbar"]})}))})}static#e=this.\u0275fac=function(r){return new(r||i)(e.Y36(N.N),e.Y36(y.u),e.Y36(n.QS),e.Y36(I.ux),e.Y36(m.F0),e.Y36(g.uw))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["vex-invoice"]],decls:99,vars:21,consts:[[1,"p-gutter","container"],["id","pdf-content",1,"card","p-16"],[1,"grid","grid-cols-2"],["id","logoImg","src","../../../../assets/sucursal.jpg",1,"h-40"],[1,"mt-12"],[1,"body-2","text-secondary","mt-0"],[1,"title","m-0"],[1,"text-secondary"],[1,"m-0"],[1,"text-right","body-1","flex","flex-col","items-end"],[1,"display-2","m-0"],[1,"mt-6"],[1,"text-secondary","body-2"],[1,"text-left","pl-4"],[1,"m-0","mt-3"],["svgIcon","mat:mail",1,"mr-2","icon-sm"],["svgIcon","mat:phone",1,"mr-2","icon-sm"],[1,"table","w-full","mt-24"],[1,"py-6","border-b","text-left"],[1,"py-6","border-b","text-right"],["id","tabla-body"],[1,"mt-8","flex","flex-col","items-end"],[1,"subheading-2","font-medium","pr-6"],[1,"text-secondary","text-right"],[1,"pl-12"],[1,"headline","font-medium","text-right","pt-6"],[1,"headline","font-medium","pl-12","pt-6"],["align","end"],[1,"flex","flex-col","sm:flex-row","sm:gap-7",2,"margin-top","65px"],[1,"flex-1","sm:w-1/4"],[4,"ngIf"],["mat-button","","type","button",3,"click"],["color","primary","mat-flat-button","","type","submit",3,"disabled","click"],["hidden",""],["mat-button","","type","button",3,"disabled","click"]],template:function(r,a){1&r&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),e._UZ(4,"img",3),e.TgZ(5,"div",4)(6,"h4",5),e._uU(7,"Cliente"),e.qZA(),e.TgZ(8,"h3",6),e._uU(9),e.qZA(),e.TgZ(10,"div",7)(11,"p",8),e._uU(12),e.qZA(),e.TgZ(13,"p",8),e._uU(14),e.qZA(),e.TgZ(15,"p",8),e._uU(16),e.qZA(),e.TgZ(17,"p",8),e._uU(18),e.qZA()()()(),e.TgZ(19,"div",9)(20,"h1",10),e._uU(21,"Comprobante de Pago"),e.qZA(),e.TgZ(22,"table",11)(23,"tbody")(24,"tr")(25,"td",12),e._uU(26,"FECHA."),e.qZA(),e.TgZ(27,"td",13),e._uU(28),e.qZA()(),e.TgZ(29,"tr")(30,"td",12),e._uU(31,"NUMERO DE SERIE"),e.qZA(),e.TgZ(32,"td",13),e._uU(33),e.qZA()(),e.TgZ(34,"tr")(35,"td",12),e._uU(36,"NUMERO DE FACTURA."),e.qZA(),e.TgZ(37,"td",13),e._uU(38),e.qZA()()()(),e.TgZ(39,"div",4)(40,"h4",5),e._uU(41,"Sucursal"),e.qZA(),e.TgZ(42,"h3",6),e._uU(43),e.qZA(),e.TgZ(44,"div",7)(45,"p",8),e._uU(46),e.qZA(),e.TgZ(47,"p",8),e._uU(48),e.qZA(),e.TgZ(49,"p",8),e._uU(50),e.qZA(),e.TgZ(51,"p",14),e._UZ(52,"mat-icon",15),e.TgZ(53,"span"),e._uU(54),e.qZA()(),e.TgZ(55,"p",8),e._UZ(56,"mat-icon",16),e.TgZ(57,"span"),e._uU(58),e.qZA()(),e.TgZ(59,"p",8)(60,"span"),e._uU(61),e.qZA()()()()()(),e.TgZ(62,"table",17)(63,"thead")(64,"tr")(65,"th",18),e._uU(66,"CODIGO"),e.qZA(),e.TgZ(67,"th",18),e._uU(68,"DESCRIPCION"),e.qZA(),e.TgZ(69,"th",18),e._uU(70,"PRECIO"),e.qZA(),e.TgZ(71,"th",18),e._uU(72,"CANTIDAD"),e.qZA(),e.TgZ(73,"th",19),e._uU(74,"TOTAL"),e.qZA()()(),e._UZ(75,"tbody",20),e.qZA(),e.TgZ(76,"div",21)(77,"table",22)(78,"tbody")(79,"tr")(80,"td",23),e._uU(81,"SUBTOTAL"),e.qZA(),e.TgZ(82,"td",24),e._uU(83),e.qZA()(),e.TgZ(84,"tr")(85,"td",23),e._uU(86,"IVA (12%)"),e.qZA(),e.TgZ(87,"td",24),e._uU(88),e.qZA()(),e.TgZ(89,"tr")(90,"td",25),e._uU(91,"TOTAL"),e.qZA(),e.TgZ(92,"td",26),e._uU(93),e.qZA()()()()()(),e.TgZ(94,"mat-dialog-actions",27)(95,"div",28)(96,"div",29),e.YNc(97,q,6,2,"ng-container",30),e.YNc(98,U,5,3,"ng-container",30),e.qZA()()()()),2&r&&(e.xp6(1),e.Q6J("@fadeInUp",void 0),e.xp6(8),e.Oqu(a.Nombre_Cliente),e.xp6(3),e.Oqu(a.Departamento_Cliente),e.xp6(2),e.Oqu(a.Municipio_Cliente),e.xp6(2),e.Oqu(a.Direccion_Cliente),e.xp6(2),e.hij("NIT:",a.NIT_Cliente||"C/F",""),e.xp6(10),e.Oqu(a.Fecha),e.xp6(5),e.Oqu(a.Numero_Serie),e.xp6(5),e.Oqu(a.Numero_Factura),e.xp6(5),e.Oqu(a.Nombre_Sucursal),e.xp6(3),e.Oqu(a.Departamento_Sucursal),e.xp6(2),e.Oqu(a.Municipio_Sucursal),e.xp6(2),e.Oqu(a.Direccion_Sucursal),e.xp6(4),e.Oqu(a.Correo_Sucursal),e.xp6(4),e.Oqu(a.Telefono_Sucursal),e.xp6(3),e.Oqu("NIT:"+a.NIT_Sucursal||0),e.xp6(22),e.hij("Q",a.SubTotal||"0.00","\u202c"),e.xp6(5),e.hij("Q",a.Iva||"0.00","\u202c"),e.xp6(5),e.hij("Q",a.Total||"0.00","\u202c"),e.xp6(4),e.Q6J("ngIf",a.valido),e.xp6(1),e.Q6J("ngIf",!a.valido))},dependencies:[_.O5,b.Hw,g.H8,v.lW],styles:["@media print{.p-gutter[_ngcontent-%COMP%]{padding:0!important}.card[_ngcontent-%COMP%]{box-shadow:none!important}}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:var(--padding);padding-right:var(--padding)}.image-upload-container[_ngcontent-%COMP%]{width:150px;height:auto;border:2px solid black;position:relative;display:flex;flex-direction:column;align-items:center;text-align:center}.image-upload-container[_ngcontent-%COMP%]   .selected-image-container[_ngcontent-%COMP%]{width:100%;flex:1;display:flex;align-items:center;justify-content:center;overflow:hidden}.image-upload-container[_ngcontent-%COMP%]   .selected-image-container[_ngcontent-%COMP%]   .selected-image-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.image-upload-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]{text-align:center;margin-top:10px}.image-upload-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]{cursor:pointer;background-color:#f0f0f0;border:1px solid #ccc;padding:5px 10px;border-radius:5px;transition:background-color .3s ease}.image-upload-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.image-upload-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.option-container[_ngcontent-%COMP%]{display:flex;align-items:center}.option-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:15%;margin-right:5px}.option-container[_ngcontent-%COMP%]   .body-2[_ngcontent-%COMP%]{margin:0}.loader[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;display:block;margin:15px auto;position:relative;color:#6120f8;left:-100px;box-sizing:border-box;animation:_ngcontent-%COMP%_shadowRolling 2s linear infinite}@keyframes _ngcontent-%COMP%_shadowRolling{0%{box-shadow:0 0 #fff0,0 0 #fff0,0 0 #fff0,0 0 #fff0}12%{box-shadow:100px 0 #261eff,0 0 #fff0,0 0 #fff0,0 0 #fff0}25%{box-shadow:110px 0 #261eff,100px 0 #0bdeed,0 0 #fff0,0 0 #fff0}36%{box-shadow:120px 0 #261eff,110px 0 #0bdeed,100px 0 #bc1fec,0 0 #fff0}50%{box-shadow:130px 0 #261eff,120px 0 #0bdeed,110px 0 #bc1fec,100px 0 #d8ec23}62%{box-shadow:200px 0 #fff0,130px 0 #0bdeed,120px 0 #bc1fec,110px 0 #d8ec23}75%{box-shadow:200px 0 #fff0,200px 0 #0bdeed,130px 0 #bc1fec,120px 0 #d8ec23}87%{box-shadow:200px 0 #fff0,200px 0 #fff0,200px 0 #fff0,130px 0 #d8ec23}to{box-shadow:200px 0 #fff0,200px 0 #fff0,200px 0 #fff0,200px 0 #fff0}}"],data:{animation:[O.$]}})}return i})(),data:{toolbarShadowEnabled:!0,containerEnabled:!0}}];let E=(()=>{class i{static#e=this.\u0275fac=function(r){return new(r||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[m.Bz.forChild(D),m.Bz,M.d8]})}return i})();var L=o(77988),w=o(24516),z=o(26385),V=o(38034),j=o(23680),R=o(98525),G=o(82599);let $=(()=>{class i{static#e=this.\u0275fac=function(r){return new(r||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[_.ez,E,n.UX,b.Ps,g.Is,L.Tx,w.c,z.t,V.FA,v.ot,j.XK,R.LD,I.ZX,G.rP]})}return i})()}}]);